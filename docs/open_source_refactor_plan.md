# Open-Source Refactor Plan for `codex-multipass`

Make the codebase generic and ready for public GitHub release by removing personal references, adding standard open-source scaffolding, and cleaning up artifacts.

## Decisions (Final)

| Decision | Choice | Rationale |
|----------|--------|-----------|
| License | **MIT** | Maximally permissive, matches existing formula claim |
| Owner/Repo | **`BigCactusLabs/codex-multipass`** | Already the git remote — zero rename friction |
| Release Flow | → **`CONTRIBUTING.md`** | Maintainer process, not end-user docs |

## Current State

The CLI (`cli/codex-switch`) is **already generic**. Personal/machine-specific items:

| File | Issue |
|------|-------|
| [README.md](file:///Users/quinn/Documents/GitHub/codex-multipass/README.md#L41) | `brew install quinn/tap/codex-switch` |
| [codex-switch.rb](file:///Users/quinn/Documents/GitHub/codex-multipass/homebrew/Formula/codex-switch.rb#L3-L8) | `homepage`, `url`, `head` hardcode `quinn/codex-multipass` |
| [update_formula.sh](file:///Users/quinn/Documents/GitHub/codex-multipass/scripts/update_formula.sh#L51-L52) | awk pattern + replacement hardcode `quinn/codex-multipass` |
| Root dir | `codex-switch-0.1.0.tar.gz` tracked (build artifact) |
| Root dir | `.DS_Store` tracked in Git |

---

## Phase 1 — Scaffolding & Cleanup (no code logic changes)

> Safe to execute immediately. No behavioral changes to the CLI.

### 1a · Create `.gitignore` and untrack artifacts

#### [NEW] [.gitignore](file:///Users/quinn/Documents/GitHub/codex-multipass/.gitignore)
- `.DS_Store`, `__pycache__/`, `*.pyc`, `*.tar.gz`, `.codex-switch.lock`

#### Untrack `.DS_Store`
```bash
git rm --cached .DS_Store
```

#### [DELETE] [codex-switch-0.1.0.tar.gz](file:///Users/quinn/Documents/GitHub/codex-multipass/codex-switch-0.1.0.tar.gz)
- Build artifact — will be generated by GitHub Releases

### 1b · Add license and community docs

#### [NEW] [LICENSE](file:///Users/quinn/Documents/GitHub/codex-multipass/LICENSE)
- MIT, copyright `BigCactusLabs contributors`

#### [NEW] [CODE_OF_CONDUCT.md](file:///Users/quinn/Documents/GitHub/codex-multipass/CODE_OF_CONDUCT.md)
- Contributor Covenant v2.1

#### [NEW] [CHANGELOG.md](file:///Users/quinn/Documents/GitHub/codex-multipass/CHANGELOG.md)
- Bootstrap `## 0.1.0` — summarize current feature set
- [Keep a Changelog](https://keepachangelog.com/) format

#### [NEW] [CONTRIBUTING.md](file:///Users/quinn/Documents/GitHub/codex-multipass/CONTRIBUTING.md)
- How to run tests, code style, PR process
- **Include Release Flow** migrated from [codex_switcher_engineer_handoff.md](file:///Users/quinn/Documents/GitHub/codex-multipass/codex_switcher_engineer_handoff.md) lines 34–39

#### [DELETE] [codex_switcher_engineer_handoff.md](file:///Users/quinn/Documents/GitHub/codex-multipass/codex_switcher_engineer_handoff.md)
- Content covered by README + CONTRIBUTING after migration

### Phase 1 Verification
```bash
# Confirm .DS_Store untracked
git status --porcelain | grep -v '\.DS_Store' && echo "PASS"
# Confirm tarball gone
[[ ! -f codex-switch-0.1.0.tar.gz ]] && echo "PASS"
# Confirm new files exist
ls LICENSE CODE_OF_CONDUCT.md CONTRIBUTING.md CHANGELOG.md .gitignore
```

---

## Phase 2 — Owner/Repo Substitution

> Replace all `quinn/codex-multipass` → `BigCactusLabs/codex-multipass`. Three files.

#### [MODIFY] [README.md](file:///Users/quinn/Documents/GitHub/codex-multipass/README.md#L41)
- `brew install quinn/tap/codex-switch` → `brew install BigCactusLabs/tap/codex-switch`

#### [MODIFY] [codex-switch.rb](file:///Users/quinn/Documents/GitHub/codex-multipass/homebrew/Formula/codex-switch.rb)
- `homepage` → `https://github.com/BigCactusLabs/codex-multipass`
- `url` → `https://github.com/BigCactusLabs/codex-multipass/archive/refs/tags/v0.1.0.tar.gz`
- `head` → `https://github.com/BigCactusLabs/codex-multipass.git`
- **`sha256`**: keep current value for now; regenerate on first GitHub Release

#### [MODIFY] [update_formula.sh](file:///Users/quinn/Documents/GitHub/codex-multipass/scripts/update_formula.sh)
- awk pattern (line 51): `quinn\/codex-multipass` → `BigCactusLabs\/codex-multipass`
- replacement (line 52): `quinn/codex-multipass` → `BigCactusLabs/codex-multipass`

### Phase 2 Verification
```bash
# No personal refs remain
rg -i 'quinn' --glob '!.git' . && echo "FAIL" || echo "PASS"

# Formula script round-trips
./scripts/update_formula.sh "$(printf '0%.0s' {1..64})"
grep 'BigCactusLabs/codex-multipass' homebrew/Formula/codex-switch.rb && echo "PASS"

# Existing tests still pass
./tests/smoke.sh
./tests/battle.sh
```

---

## Phase 3 — CI & Final Polish

> Add GitHub Actions and regenerate the repo map.

#### [NEW] [.github/workflows/ci.yml](file:///Users/quinn/Documents/GitHub/codex-multipass/.github/workflows/ci.yml)
- Trigger: push + PR to `main`
- Matrix: `ubuntu-latest`, `macos-latest`
- Steps: `tests/smoke.sh`, `tests/battle.sh`, ShellCheck on all `.sh` files + `cli/codex-switch`
- Both test scripts already use `set -euo pipefail` — CI-ready

#### [MODIFY] [docs/repo_folder_map.md](file:///Users/quinn/Documents/GitHub/codex-multipass/docs/repo_folder_map.md)
- `./scripts/run_repo_map.sh generate "Post open-source cleanup"`

### Phase 3 Verification
```bash
# ShellCheck locally
shellcheck cli/codex-switch scripts/*.sh tests/*.sh

# Full test suite
./tests/smoke.sh
./tests/battle.sh

# Final personal-ref sweep
rg -i 'quinn' --glob '!.git' . && echo "FAIL" || echo "PASS"
```

### Manual Verification (post Phase 3)
- Review `LICENSE`, `CODE_OF_CONDUCT.md`, `CONTRIBUTING.md`, `CHANGELOG.md` for accuracy
- Confirm Homebrew formula URLs point to `BigCactusLabs/codex-multipass`
- Push a test branch and confirm CI runs green
